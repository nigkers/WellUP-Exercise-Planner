<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WellUP - Your personal health and wellness companion.">
    <meta name="theme-color" content="#10B981">
    
    <title>WellUP | Wellness Companion</title>
    
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/@n8n/chat/dist/style.css" rel="stylesheet" />
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='75' font-size='75' fill='%2310B981'>üíö</text></svg>">
</head>
<body>
    <div id="app" class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">WellUP</div>
                <nav class="nav-menu">
                    <button class="nav-btn active" data-page="dashboard">üìä Dashboard</button>
                    <button class="nav-btn" data-page="add-workout">‚ûï Add Workout</button>
                    <button class="nav-btn" data-page="insights">üìà Insights</button>
                </nav>
                <button class="menu-btn" id="menuBtn" aria-label="Menu">
                    <span class="menu-icon">‚ò∞</span>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page" id="page-dashboard" style="display: block;">
                <!-- Hero Section -->
                <section class="hero">
                    <h1>Welcome to WellUP</h1>
                    <p>Your wellness journey starts here</p>
                </section>

                <!-- Stats Section -->
                <section class="stats-section">
                    <div class="stat-card">
                        <div class="stat-icon">üéØ</div>
                        <div class="stat-text">
                            <div class="stat-number" id="workoutCount">0</div>
                            <div class="stat-label">Workouts</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">‚è±Ô∏è</div>
                        <div class="stat-text">
                            <div class="stat-number" id="totalMinutes">0</div>
                            <div class="stat-label">Minutes</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon">üî•</div>
                        <div class="stat-text">
                            <div class="stat-number" id="caloriesBurned">0</div>
                            <div class="stat-label">Calories</div>
                        </div>
                    </div>
                </section>

                <!-- Workout Section -->
                <section class="workouts-section">
                    <div class="section-header">
                        <h2>Upcoming Workouts</h2>
                    </div>
                    <div class="workouts-list" id="workoutsList">
                        <!-- Workouts will be populated here -->
                    </div>
                </section>

                <!-- Weekly Calendar -->
                <section class="calendar-section">
                    <h2>This Week</h2>
                    <div class="week-calendar" id="weekCalendar">
                        <!-- Calendar will be populated here -->
                    </div>
                </section>
            </div>

            <!-- Add Workout Page -->
            <div class="page" id="page-add-workout" style="display: none;">
                <section class="form-page">
                    <h1>Add Workout</h1>
                    <form id="workoutForm" class="workout-form">
                        <div class="form-group">
                            <label for="workoutName">Workout Name</label>
                            <input type="text" id="workoutName" placeholder="e.g., Morning Run" required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="workoutDate">Date</label>
                                <input type="date" id="workoutDate" required>
                            </div>
                            <div class="form-group">
                                <label for="workoutTime">Time</label>
                                <input type="time" id="workoutTime" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="workoutDuration">Duration (minutes)</label>
                                <input type="number" id="workoutDuration" min="1" placeholder="30" required>
                            </div>
                            <div class="form-group">
                                <label for="workoutCalories">Calories</label>
                                <input type="number" id="workoutCalories" min="0" placeholder="200" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="workoutType">Type</label>
                            <select id="workoutType" required>
                                <option value="">Select Type</option>
                                <option value="cardio">Cardio</option>
                                <option value="strength">Strength</option>
                                <option value="flexibility">Flexibility</option>
                                <option value="sports">Sports</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="workoutNotes">Notes</label>
                            <textarea id="workoutNotes" placeholder="How did it go?"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Save Workout</button>
                        </div>
                    </form>
                </section>
            </div>

            <!-- Insights Page -->
            <div class="page" id="page-insights" style="display: none;">
                <section class="insights-page">
                    <h1>Insights</h1>
                    <div class="insights-container">
                        <div class="insight-card">
                            <h3>Weekly Summary</h3>
                            <div class="insight-content">
                                <div class="insight-stat">
                                    <span class="insight-label">Total Workouts</span>
                                    <span class="insight-value" id="insightWorkoutCount">0</span>
                                </div>
                                <div class="insight-stat">
                                    <span class="insight-label">Total Minutes</span>
                                    <span class="insight-value" id="insightTotalMinutes">0</span>
                                </div>
                                <div class="insight-stat">
                                    <span class="insight-label">Calories Burned</span>
                                    <span class="insight-value" id="insightCalories">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="insight-card">
                            <h3>Workout Distribution</h3>
                            <div class="insight-content" id="insightDistribution">
                                <!-- Will be populated with workout types -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h3>Weekly Activity</h3>
                            <div class="insight-content" id="insightActivity">
                                <!-- Will be populated with daily activity -->
                            </div>
                        </div>

                        <div class="insight-card">
                            <h3>Personal Records</h3>
                            <div class="insight-content" id="insightRecords">
                                <!-- Will be populated with records -->
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </main>


        <!-- Footer -->
        <footer class="footer">
            <p>&copy; 2026 WellUP. Your wellness companion.</p>
        </footer>
    </div>

    <script src="js/app.js"></script>
    <script type="module">
    // Wait for StorageManager to be available
    if (typeof StorageManager !== 'undefined') {
        import { createChat } from 'https://cdn.jsdelivr.net/npm/@n8n/chat/dist/chat.bundle.es.js';

        // Get the latest stats from your app logic
        let stats = StorageManager.calculateStats();

        window.wellupChat = createChat({
            webhookUrl: 'https://n8ngc.codeblazar.org/webhook/d301581f-d8b8-4f3e-a2b9-7ed782b9bfbc/chat',
            title: 'WellUP Coach',
            initialMessages: [
                `Hi! I'm your WellUP Coach. I see you've done ${stats.count} workouts this week. How can I help you today?`
            ],
            metadata: {
                workoutCount: stats.count,
                totalMinutes: stats.totalMinutes,
                totalCalories: stats.totalCalories
            }
        });

        // Intercept fetch calls to inject current stats into webhook requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const config = args[1];

            // Check if this is a request to the chat webhook
            if (url && typeof url === 'string' && url.includes('d301581f-d8b8-4f3e-a2b9-7ed782b9bfbc')) {
                if (config && config.body) {
                    try {
                        // Parse the existing body
                        const body = typeof config.body === 'string' ? JSON.parse(config.body) : config.body;
                        
                        // Get current stats and inject them
                        const currentStats = StorageManager.calculateStats();
                        body.metadata = {
                            workoutCount: currentStats.count,
                            totalMinutes: currentStats.totalMinutes,
                            totalCalories: currentStats.totalCalories
                        };
                        
                        // Update the request body with fresh stats
                        config.body = JSON.stringify(body);
                    } catch (e) {
                        console.log('Could not update fetch body');
                    }
                }
            }

            return originalFetch.apply(this, args);
        };
    }
</script>
</body>
</html>
